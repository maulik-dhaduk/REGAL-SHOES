<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="icon" type="image/x-icon" href="images/Favicon/154-2021_07_25-favicon_regal_250.jpg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .cart-img {
            width: 180px !important;
            height: auto !important;
            flex-shrink: 0;
        }

        .summary-box {
            position: sticky;
            top: 20px;
        }


        .qty-box {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid #999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
        }

        .flex-wrapper {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
            justify-content: space-between;
        }

        .empty-cart-container {
            text-align: left;
            padding: 50px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-img {
            max-width: 100%;
            width: 100%;
            height: auto;
            opacity: 0.7;
            display: block;
        }

        @media (max-width: 768px) {
            .empty-cart-container {
                padding: 20px 10px;
            }

            .empty-img {
                max-width: 80%;
            }
        }
    </style>
</head>

<body>
    <div id="navbar-container"></div>
    <div class="flex-wrapper">

        <div class="container py-5">

            <h1 class="fw-bold mb-5">My shopping cart</h1>
            <div class="row">

                <div class="col-lg-8" id="cart-product">
                </div>

                <div class="col-lg-4">
                    <div class="p-4 border rounded summary-box">
                        <h4 class="fw-bold mb-4">Order Summary</h4>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal</span>
                            <span id="subtotal"></span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping Cost</span>
                            <span id="shipping"></span>
                        </div>
                        <div class="mt-3 fw-semibold">
                            <div class="d-flex justify-content-between">
                                <span>Price</span>
                                <span id="total"></span>
                            </div>
                        </div>
                        <button class="btn btn-dark w-100 py-3 mt-4"
                            onclick="window.location.href='checkout.html'">PROCEED</button>
                        <button class="btn btn-outline-dark w-100 py-3 mt-3"
                            onclick="window.location.href='index.html'">CONTINUE SHOPPING</button>

                    </div>
                </div>
            </div>

        </div>
        <div id="footer-container"></div>
    </div>
    <script>

        let products = JSON.parse(localStorage.getItem("cart_product")) || [];


        function Update_cart() {
            localStorage.setItem("cart_product", JSON.stringify(products))
            updateCartCounter()
        }

        function Increment(pro_index) {

            products[pro_index].quantity++

            Update_cart()
            cart_Product_Details()
        }

        function Decrement(pro_index) {

            if (products[pro_index].quantity > 1) {
                products[pro_index].quantity--
            } else {
                products.splice(pro_index, 1)
            }

            Update_cart()
            cart_Product_Details()
        }


        function Remove_Product(pro_index) {
            products.splice(pro_index, 1)
            Update_cart()
            cart_Product_Details()
        }


        function Update_Total() {
            let subtotal = 0

            products.map((pro) => {
                let product_price = parseFloat(pro.offer_rate.toString().replace(/[^0-9.]/g, ""));
                let product_total = product_price * pro.quantity
                subtotal = subtotal + product_total
            })

            let shipping_price = products.length > 0 ? 50 : 0
            let main_total = subtotal + shipping_price

            document.getElementById("subtotal").innerText = subtotal.toFixed(2);
            document.getElementById("shipping").innerText = shipping_price;
            document.getElementById("total").innerText = main_total.toFixed(2);
        }



        function cart_Product_Details() {
            const container = document.getElementById("cart-product");
            const summaryBox = document.querySelector(".summary-box");

            let user_login = JSON.parse(localStorage.getItem("Sign_IN_Data"))

            if (user_login) {

                if (products.length === 0) {
                    container.innerHTML = `
                    <div class="container empty-cart-container">
                    <div class="d-flex flex-column" style="max-width: 520px; width: 100%;">
                        <img src="https://s3-ap-southeast-1.amazonaws.com/asianapp/digital-website/Empty%20Cart_46339935680432126925.png" alt="Empty Cart" class="empty-img">
                        <p class="text-center text-muted fw-semibold">You don't have any item in your cart</p>
                    </div>
                    </div>`
                    summaryBox.style.display = 'none';
                    Update_Total()
                    return;
                } else {
                    summaryBox.style.display = 'block';
                }
                container.innerHTML = ``
                products.forEach((product, index) => {

                    const col = document.createElement("div");
                    col.classList.add("col");
                    let price = parseFloat(product.offer_rate.toString().replace(/[^0-9.]/g, ""));
                    let product_total = (price * product.quantity).toFixed(2);

                    col.innerHTML = `
                        <div class="d-flex flex-nowrap border-bottom pb-4 mb-4">
                        <div class="me-4">
                            <img src="${product.image}" class="img-fluid cart-img" style="cursor: pointer;">
                        </div>

                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <p class="fw-bold text-uppercase mb-1">${product.brand_name}</p>
                                    <h5 class="fw-semibold mb-2">${product.title}</h5>
                                </div>

                                <div class="ms-3 d-flex align-items-center">
                                    <div onclick="Remove_Product(${index})"><i class="bi bi-trash fs-5 m-2" style="cursor: pointer;"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center my-2">
                                <span class="text-decoration-line-through me-2 text-muted">${product.orignal_rate}</span>
                                <span class="text-danger fw-semibold">${product.offer_rate}</span>
                            </div>


                            <p class="mb-1"><b>Color:</b> ${product.color}</p>
                            <div class="qty-box">
                                <div class="qty-btn" onclick="Decrement(${index})">-</div>
                                <strong>${product.quantity}</strong>
                                <div class="qty-btn" onclick="Increment(${index})">+</div>
                            </div>

                            <p class="mt-2 mb-0"><strong>Total: â‚¹${product_total}</strong></p>
                        </div>
                    </div>`
                    let image_tag = col.querySelector("img")
                    image_tag.addEventListener("click", () => {
                        window.location.href = `product.html?id=${product.id}`
                    })
                    container.appendChild(col);
                });
                Update_Total()

            } else {
                container.innerHTML = `
                    <div class="container empty-cart-container">
                    <div class="d-flex flex-column" style="max-width: 520px; width: 100%;">
                        <img src="https://s3-ap-southeast-1.amazonaws.com/asianapp/digital-website/Empty%20Cart_46339935680432126925.png" alt="Empty Cart" class="empty-img">
                        <p class="text-center text-muted fw-semibold">You don't have any item in your cart</p>
                    </div>
                    </div>                
                `;
                summaryBox.style.display = 'none';
                Update_Total()
                return;
            }
        }

        cart_Product_Details();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/global.js"></script>
</body>

</html>